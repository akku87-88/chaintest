<!-- main-content -->
<div class="main-content app-content">
    <div class="page-header mt-4">
        <div class="container">
            <div class="d-flex">
                <h4>Projects</h4>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="mt-3 mb-3 d-flex justify-content-between">
            <div>
              <div class="input-group">
                <input type="text" class="form-control" placeholder="Search projects.." 
                  aria-label="Search projects.." aria-describedby="basic-addon2" 
                  [(ngModel)]="q" (ngModelChange)="search()" 
                  title="Search all projects using: name, tags or the test-runner name" />
                <span class="input-group-text" id="basic-addon2"><i class="bi bi-search small"
                  title="Search all projects using: name, tags or the test-runner name"></i></span>
              </div>
            </div>
            <div class="d-flex ">
              <button type="button" class="btn btn-outline-light btn-sm" *ngIf="projectPage">
                  Showing {{projectPage.numberOfElements}} of {{projectPage.totalElements}} projects
              </button>
            </div>
        </div>

        <div class="row" *ngIf="projectPage && projectPage.content.length && projectPage.content[0].builds">
          <ng-container *ngFor="let project of projectPage.content">
            <div class="col-4" *ngIf="project.display">
              <div class="card d-on-hover" *ngIf="project.builds">
                <div class="card-header d-flex">
                  <h5 class="mb-0 pointer" [routerLink]="['projects', project.id, 'builds']">{{project.name}}</h5>
                  <div class="ms-auto fs-6">
                    <i class="bi bi-check-circle-fill text-success" *ngIf="project.builds.content[0].result == 'PASSED'"></i>
                    <i class="bi bi-x-circle-fill text-danger" *ngIf="project.builds.content[0].result != 'PASSED'"></i>
                  </div>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-4">
                      <small class="card-text-sm text-muted mb-1">Builds</small>
                      <h6>{{project.builds.totalElements}}</h6>
                    </div> 
                    <div class="col-8">
                      <small class="card-text-sm text-muted mb-1">Last Build</small>
                      <h6>{{project.builds.content[0].startedAt | timeago}}</h6>
                    </div> 
                  </div>
                </div>
                <div class="card-footer no-bg" style="height:53px">
                  <div class="d-flex flex-row">
                    <a class="status-bar" 
                      *ngFor="let build of project.builds.content | slice:0:12"
                      [ngClass]="{'status-success': build.result.toString() == 'PASSED', 'status-failure': build.result.toString() != 'PASSED'}"
                      [routerLink]="['projects', project.id, 'builds', build.id]"
                      ngbTooltip="{{build.result}}, {{build.startedAt | timeago}} - Took {{moment.utc(build.durationMs).format('HH:mm:ss')}}"
                      tooltipClass="text-sm">
                    </a>
                    <div class="ms-auto pointer d-on-hover-target" ngbDropdown>
                      <span ngbDropdownToggle><i class="bi bi-three-dots"></i></span>
                      <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                        <button ngbDropdownItem>Delete project</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>

          <div class="my-5">
            <app-paginate [entity]="projectPage" *ngIf="projectPage.totalPages >= 2"></app-paginate>
          </div>
        </div>
    </div>
</div>
<!-- /main-content -->
